<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="co.company.MatchFootball.mapper.HyendongMapper"> <!-- 패키지.EmpMapper -->

	<!-- 아이디 소속된 팀 정보 -->
	<select id="idTeamSelect" parameterType="MembersVO"
		resultType="TeamVO">
		select *
		from members m
		join team t
		on m.t_name = t.t_name
		where m.id=#{id}
	</select>

	<!-- 팀리스트 조회 -->
	<select id="teamListSelect" resultType="TeamVO"
		parameterType="TeamVO">
		select * from( select a.*, rownum rn from (
		SELECT *
		FROM TEAM
		ORDER BY t_num
		) a ) b where rn between #{first} and #{last}

	</select>
	<select id="selectCount" resultType="TeamVO">
		select count(*) count from  teamlist where t_num = #{t_num}
	</select>
	<!-- 팀 등록 -->
	<insert id="teamInsert" parameterType="TeamVO">
		<selectKey order="BEFORE" keyProperty="t_num"
			resultType="string">
			SELECT MAX(t_num)+1
			FROM team
		</selectKey>
		INSERT INTO TEAM (t_num,
		t_name,
		t_max,
		t_address,
		t_type,
		t_info,
		t_logo,
		t_hidden
		)
		VALUES(
		#{t_num},
		#{t_name},
		#{t_max},
		#{t_address},
		#{t_type},
		#{t_info},
		#{t_logo,jdbcType=VARCHAR},
		#{t_hidden})
	</insert>
	
	<!-- 팀 리스트 추가 -->
	<insert id="teamListInsert" parameterType="TeamlistVO">
		INSERT INTO teamList(
			t_num,
			id,
			t_author)
		VALUES(
			#{t_num},
			#{id},
			#{t_author}
		)
	</insert>

	<!-- 팀 단건 정보 조회 -->
	<select id="getTeam" parameterType="TeamVO" resultType="TeamVO">
		SELECT *
		FROM team
		WHERE t_num = #{t_num}
	</select>

	<!-- 팀원 조회 -->
	<select id="getTeamMembers" parameterType="TeamlistVO"
		resultType="TeamlistVO">
		select * from teamlist where t_num = #{t_num} order by 3 desc
	</select>

	<select id="getTeamMemberss" parameterType="TeamlistVO"
		resultType="TeamlistVO">
		select * from teamlist where id = #{id}	and t_num = #{t_num}
	</select>

	<!-- 팀 정보 변경 -->
	<update id="teamUpdate">
		UPDATE TEAM
		SET t_name = #{t_name},
		t_max = #{t_max},
		t_address = #{t_address},
		t_type = #{t_type},
		t_logo = #{t_logo,jdbcType=VARCHAR},
		t_info = #{t_info},
		t_hidden = #{t_hidden}
		WHERE t_num = #{t_num}
	</update>

	<!-- 팀 공지 등록 -->
	<insert id="NoticeInsert" parameterType="TnoticeVO">
		<selectKey order="BEFORE" keyProperty="n_no"
			resultType="int">
			SELECT NVL(MAX(n_no),0)+1
			FROM tnotice
		</selectKey>
		INSERT INTO tnotice(
				n_no,
				t_num,
				t_content,
				t_title,
				t_id,
				t_date)
		VALUES (
			#{n_no},
			#{t_num},
			#{t_content},
			#{t_title},
			#{t_id},
			sysdate
		)
	</insert>
	
	<update id="NoticeUpdate">
		UPDATE tnotice
		SET t_title = #{t_title},
			t_content = #{t_content},
			t_date = sysdate
		WHERE n_no = #{n_no}
		
	</update>
	<!-- 팀 공지 삭제 -->
	<delete id="NoticeDelete" parameterType="TnoticeVO">
		DELETE FROM tnotice
		WHERE n_no = #{n_no}
	</delete>

	<!-- 팀원 수 -->
	<select id="countSelect" resultType="TeamlistVO">
		SELECT COUNT(*) AS TEAM
		FROM teamlist
		WHERE t_num = #{t_num}
	</select>

	<!-- 팀 공지 조회 -->
	<select id="NoticeSelect" parameterType="TnoticeVO" resultType="TnoticeVO">
		SELECT n_no, t_title, to_date(t_date, 'yyyy-mm-dd HH24:MI:SS'), t_no
		FROM tnotice
		WHERE t_num = #{t_num}
		
	</select>
	
	<!-- 팀 공지 상세 조회 -->
	<select id="NoticeSelectInfo" parameterType="TnoticeVO" resultType="TnoticeVO">
		SELECT *
		FROM tnotice
		WHERE t_num = #{t_num} AND n_no = #{n_no}
	</select>
	
	<!-- 멤버리스트 조회 -->
	<select id="getMembers" parameterType="MembersVO"
		resultType="MembersVO">
		SELECT *
		FROM members
		WHERE t_num is null
	</select>
	<!-- 멤버 단건 조회 -->
	<select id="memberSelect" parameterType="MembersVO" resultType="MembersVO">
		SELECT *
		FROM members
		WHERE id = #{id}
	</select>

	<!-- 토너먼트 리스트 조회 -->
	<select id="tournamentListSelect" resultType="TournamentVO">
		SELECT *
		FROM tournament
		ORDER BY s_date
	</select>

	<!-- 토너먼트 정보 단건 조회 -->
	<select id="getTournament" parameterType="TournamentVO"
		resultType="TournamentVO">
		SELECT *
		FROM tournament
		WHERE t_no = #{t_no}
	</select>

	<!-- 팀 토너먼트 참가 -->
	<insert id="tournamentInsert" parameterType="TournamentTeamVO">
		INSERT INTO tournamentteam(
			t_num,
			t_log,
			t_wn,
			t_no)
		VALUES(
			#{t_num},
			#{t_log},
			#{t_wn},
			#{t_no}
		)
	</insert>

	<!--p_match 내역 수 페이징 -->
	<select id="getCount1" resultType="int">
		SELECT COUNT(*) FROM team
	</select>

	<!-- 토너먼트 대진표 조회 -->
	<select id="tournamentPVP" parameterType="TournamentTeamVO"
		resultType="TournamentTeamVO">
		select t.t_name from tournamentteam tt join team t on tt.t_num = t.t_num where t_no=#{t_no}
	</select>
	
	<!-- 멤버 팀 번호 변경 -->
	<update id="tNumUpdate">
	update members 
	set t_num = #{t_num} 
	where id=#{id}
	</update>
	
	<!-- 멤버 팀 널 변경 -->
	<update id="tNumNullUpdate">
	update members 
	set t_num = null 
	where id=#{id}
	</update>
	
	<!-- 사진 조회 -->
	<select id="picSelect" resultType="TgalleryVO">
		select img
		from tgallery
		where t_num = #{t_num}
	</select>
	
	<!-- 사진 삽입 -->
	<insert id="picInsert" parameterType="TgalleryVO">
		<selectKey order="BEFORE" keyProperty="g_no"
			resultType="int">
			SELECT MAX(g_no)+1
			FROM tgallery
		</selectKey>
		INSERT INTO tgallery (
			g_no,
		    t_num,
			img)
		VALUES(
			#{g_no},
			#{t_num},
			#{img}
		)
	</insert>
	
	<!-- 팀 가입 신청 인바이트 -->
	<insert id="teamInvite" parameterType="TinviteVO">
		<selectKey order="BEFORE" keyProperty="i_no"
			resultType="int">
			SELECT NVL(MAX(i_no),0)+1
			FROM tinvite
		</selectKey>
		INSERT INTO tinvite (
			i_no,
			t_num,
			id,
			i_age,
			i_pos,
			i_lv,
			i_manner)
		VALUES(
			#{i_no},
			#{t_num},
			#{id},
			#{i_age},
			#{i_pos},
			#{i_lv},
			#{i_manner}
		)
	</insert>
	
	<!-- 팀 가입 신청 조회 -->
	<select id="teamInviteSelect" resultType="TinviteVO">
		SELECT * 
		FROM tinvite
		WHERE t_num = #{t_num}
	</select>
	
	<select id="teamInviteSelectt" resultType="TinviteVO">
		SELECT * 
		FROM tinvite
		WHERE id = #{id}
	</select>
	
	<!-- 팀 초대에서 삭제 -->
	<delete id="teamInviteDelete" parameterType="TinviteVO">
		DELETE FROM tinvite
		WHERE t_num = #{t_num}
		AND id = #{id}
	</delete>
	
	<!-- 팀원 추방 -->
	<delete id="teamMemberOut" parameterType="TeamlistVO">
		DELETE FROM teamList
		WHERE id = #{id}
	</delete>
	
	<!-- 팀리스트 탈퇴 -->
	<delete id="teamListOut" parameterType="TeamlistVO">
		DELETE FROM teamlist
		WHERE id = #{id}
	</delete>
	
	<!-- 토너먼트 참가 -->
	<insert id="teamTournaInsert" parameterType="TournamentTeamVO">
		INSERT INTO tournamentteam
		VALUES(#{t_num}, null, null, #{t_no})
	</insert>
	
	<!-- 토너먼트 참가 팀 수 -->
	<select id="teamTournaCount" resultType="TournamentTeamVO">
		SELECT count(*)
		FROM tournamentteam
		WHERE t_no = #{t_no}
	</select>
</mapper>
